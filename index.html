<!DOCTYPE html>
<title> Pluviométrie du Grand Lyon </title>
<link rel="stylesheet" type="text/css" href="leaflet.css" />
<link rel="stylesheet" href="style_css\style.css" type="text/css">
<meta charset="utf-8">


<style>
#map { height: 400px; width: 400px; float:left; margin-left:20px; margin-right:20px;}
</style>

<body onload="load_data()">  <!-- Récupération des données avec le chargement de la page -->


<h1> Pluviométrie du Grand Lyon </h1>

<fieldset>
  <div style="float:left;width:25%;">
    <div id="map"></div>

   <div id="reponse">
     <p align="center"></p>
     <img width="70%" src="" />
   </div>
   <div>
   </div>
   </body>

  <script>
  // Creation d'une carte dans la balise div "map", et positionne la vue sur un point donné et un niveau de zoom
  var map = L.map('map').setView([46.5,2.5], 5);
  // Ajout d'une couche de dalles OpenStreetMap
  L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
       attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
       }).addTo(map);

  function load_data () {
      var xhr = new XMLHttpRequest();
      xhr.onload = function() {   // fonction callback
        // récupération des données renvoyées par le serveur
  	  var data = JSON.parse(this.responseText);
        // boucle sur les enregistrements renvoyés
        for ( n = 0; n < data.length; n++ ) {
          // insertion d'un marqueur à la position, attachement d'une popup, capture de l'évènement "clic'
  	    L.marker([data[n].lat,data[n].lon]).addTo(map)
            .bindPopup(data[n].nom)
  		  .addEventListener('click',OnMarkerClick)
  		  .idreg=data[n].nom;   // propriété personnalisée ajouté au marqueur
  	    }
      };
      xhr.open('GET','/regions',true);
      xhr.send();
  }

  function OnMarkerClick (e) {
      var xhr = new XMLHttpRequest();
  	var image =  document.querySelector('#reponse img'),
          legende = document.querySelector('#reponse p');
  	xhr.onload = function() {   // fonction callback
        var data = JSON.parse(this.responseText)
        image.src = data.img;
        image.alt = data.title;
        legende.innerHTML = data.title;
        };
      xhr.open('GET','/ponctualite/'+e.target.idreg,true);  // on récupère la courbe par un appel au serveur
      xhr.send();
  }

  function OnAjoutStationClick (e) {

  }

  function OnAffichageClick (e) {

  }

  </script>

  <div>
  <label> <button type="button" id="bouton_ajout_station"> Ajouter la station </button>
  <label> <button type="button" id="bouton_affichage"> Affichage des statistiques </button>
  </div>

  </div>



  <div style="float:left;width:75%;">

    <div>

      <script language="Javascript" type="text/javascript" >
function choix(formulaire)
{
var j;
var i = formulaire.boite1.selectedIndex;
if (i == 0)
for(j = 1; j <3; j++)
formulaire.boite2.options[j].text="";


else{
switch (i){
case 1 : var text = new Array( "Marseille","PSG","Monaco");
break;
case 2 : var text = new Array("Toulouse","Agen","Paris");
break;

case 3 : var text = new Array("Dijon","Pau","Gravelines");
break;
}

for(j = 0; j<3; j++)
formulaire.boite2.options[j+1].text=text[j];
}
formulaire.boite2.selectedIndex=0;
}
</script>
</head>
<body>
<form name="formulaire">
<select name="boite1" onChange="choix(this.form)">
<option selected>...........Choisissez une rubrique...........</option>
<option>foot</option>
<option>rugby</option>
<option>basket</option>

</select>

<select name="boite2">
<option selected>...........Choisissez une rubrique...........</option>
<option></option>
<option></option>
<option></option>
</form>
</select></body></html>


        <label>Pas de temps (en minutes) : <input name="Pastps" id="pastps"></label><br>

        <FORM> Date de fin :
        <SELECT name="nom" size="1">
        <OPTION>lundi
        <OPTION>mardi
        <OPTION>mercredi
        <OPTION>jeudi
        <OPTION>vendredi
        </SELECT>
        </FORM>

    </div>

  </div>
  <p id="reponse"></p>
  </fieldset>
